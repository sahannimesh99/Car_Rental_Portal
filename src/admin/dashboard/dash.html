<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <link href="../../assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../assets/fontawesome/css/all.min.css" rel="stylesheet">
    <link href="../../assets/css/dashboard.css" rel="stylesheet">
    <link href="../../assets/css/adminDash.css" rel="stylesheet">
</head>
<body>
<nav class="nav bg-purple justify-content-center">
    <a class="nav-link text-white" onclick="adminDashboardHome()" role="button"><i aria-hidden="true"
                                                                                   class="fa fa-home"></i> Home</a>
    <a class="nav-link text-white" data-target="#updateUserDetail" data-toggle="modal" href="#" role="button"><i
            aria-hidden="true" class="fa fa-user-cog"></i> Settings</a>
    <a class="nav-link text-white" onclick="logOut()" role="button">Logout <i aria-hidden="true"
                                                                              class="fa fa-sign-out-alt"></i></a>
</nav>
<div class="container py-5">
    <div class="row">
        <div class="col-lg-12 p-5">
            <h1 id="main-title"><i aria-hidden="true" class="fa fa-tachometer-alt"></i> Hi, Easy Car Rental System</h1>
            <hr/>
        </div>
    </div>
    <div class="row d-flex justify-content-between">
        <div class="col-xs-6 col-sm-6 col-md-3 col-lg-2 p-2">
            <a class="text-decoration-none" onclick="adminCarSectionPane()" role="button">
                <div class="card p-3 shadow bg-purple text-center border-0">
                    <div class="card-body">
                        <i aria-hidden="true" class="fa fa-car fa-2x"></i>
                        <hr/>
                        <p class="card-title">Cars</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-3 col-lg-2 p-2">
            <a class="text-decoration-none" onclick="adminCustomerSectionPane()" role="button">
                <div class="card p-3 shadow bg-purple text-center border-0">
                    <div class="card-body">
                        <i aria-hidden="true" class="fa fa-users fa-2x"></i>
                        <hr/>
                        <p class="card-title">Customers</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-3 col-lg-2 p-2">
            <a class="text-decoration-none" onclick="adminRequestSectionPane()" role="button">
                <div class="card p-3 shadow bg-purple text-center border-0">
                    <div class="card-body">
                        <i aria-hidden="true" class="fa fa-edit fa-2x"></i>
                        <hr/>
                        <p class="card-title">Requests</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-3 col-lg-2 p-2">
            <a class="text-decoration-none" onclick="adminDriverSectionPane()" role="button">
                <div class="card p-3 shadow bg-purple text-center border-0">
                    <div class="card-body">
                        <i aria-hidden="true" class="fa fa-user-friends fa-2x"></i>
                        <hr/>
                        <p class="card-title">Drivers</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-3 col-lg-2 p-2">
            <a class="text-decoration-none" href="#">
                <div class="card p-3 shadow bg-purple text-center border-0">
                    <div class="card-body">
                        <i aria-hidden="true" class="fa fa-cash-register fa-2x"></i>
                        <hr/>
                        <p class="card-title">Payments</p>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-xs-6 col-sm-6 col-md-3 col-lg-2 p-2">
            <a class="text-decoration-none" data-target="#modelHELP" data-toggle="modal" href="#">
                <div class="card p-3 shadow bg-purple text-center border-0">
                    <div class="card-body">
                        <i aria-hidden="true" class="fa fa-tools fa-2x"></i>
                        <hr/>
                        <p class="card-title">Maintenance</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>
<!--Dashboard cards-->
<div class="container" id="mainDashboard" style="padding: 10px; background-color: #f5f5f5; display: block;">
    <div class="row" style="padding: 10px;">
        <div class="col">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5 class="card-title">Registered Users</h5>
                    <p class="card-text lead">10000</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h5 class="card-title">Today bookings</h5>
                    <p class="card-text lead">20</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card bg-warning">
                <div class="card-body">
                    <h5 class="card-title">Available Cars</h5>
                    <p class="card-text lead">8</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card bg-danger text-white">
                <div class="card-body">
                    <h5 class="card-title">Reserved Cars</h5>
                    <p class="card-text lead">12</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="padding: 10px;">
        <div class="col">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h5 class="card-title">Active bookings</h5>
                    <p class="card-text lead">5</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card text-white" style="background-color: #7b1fa2">
                <div class="card-body">
                    <h5 class="card-title">Available Drivers</h5>
                    <p class="card-text lead">8</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card bg-dark text-white">
                <div class="card-body">
                    <h5 class="card-title">Occupied Drivers</h5>
                    <p class="card-text lead">10</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">Maintenance Cars</h5>
                    <p class="card-text lead">3</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!--Car-->
<div class="container" id="carSection" style="padding: 10px; background-color: #f5f5f5; display: none;">
    <div class="d-flex justify-content-end">
        <button class="btn btn-primary" onclick="function showCarAddModel() {
            $('#adminCarAddModel').modal('show');
        }
        showCarAddModel()" type="button">Add Car
        </button>
        <!-- Add a car   -->
        <div aria-hidden="true" aria-labelledby="staticBackdropLabel" class="modal fade" data-backdrop="static"
             data-keyboard="false"
             id="adminCarAddModel" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Add New Car</h5>
                        <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col">
                                <label for="carRegNumber">Registration No</label>
                                <input class="form-control" id="carRegNumber" placeholder="Registration No" type="text">
                            </div>
                            <div class="col">
                                <label for="carBrand">Car Brand</label>
                                <input class="form-control" id="carBrand" placeholder="Car Brand" type="text">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="carColor">Color of Car</label>
                                <input class="form-control" id="carColor" placeholder="Color of Car" type="text">
                            </div>
                            <div class="col">
                                <label for="carPassengerCount">Passenger Count</label>
                                <input class="form-control" id="carPassengerCount" placeholder="Passenger Count"
                                       type="text">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="carDailyFreeKm">Daily Free KM</label>
                                <input class="form-control" id="carDailyFreeKm" placeholder="Daily Free KM" type="text">
                            </div>
                            <div class="col">
                                <label for="carMonthlyFreeKm">Monthly Free KM</label>
                                <input class="form-control" id="carMonthlyFreeKm" placeholder="Monthly Free KM"
                                       type="text">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="carDailyRate">Daily Rate</label>
                                <input class="form-control" id="carDailyRate" placeholder="Daily Rate" type="text">
                            </div>
                            <div class="col">
                                <label for="carMonthlyRate">Monthly Rate</label>
                                <input class="form-control" id="carMonthlyRate" placeholder="Monthly Rate"
                                       type="text">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="carDrivenKm">Driven KM</label>
                                <input class="form-control" id="carDrivenKm" placeholder="Driven KM" type="text">
                            </div>
                            <div class="col">
                                <label for="carExtraKmPrice">Extra KM Price</label>
                                <input class="form-control" id="carExtraKmPrice" placeholder="Extra KM Price"
                                       type="text">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="carFuelType">Fuel Type</label>
                                <select class="form-control" id="carFuelType" name="carFuelType">
                                    <option value="Petrol">Petrol</option>
                                    <option value="Diesel">Diesel</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="carTransmissionType">Transmission Type</label>
                                <select class="form-control" id="carTransmissionType" name="carTransmissionType">
                                    <option value="Manual">Manual</option>
                                    <option value="Auto">Auto</option>
                                    <option value="Hybrid">Hybrid</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="carType">Car Type</label>
                                <select class="form-control" id="carType" name="carType">
                                    <option value="General">General</option>
                                    <option value="Premium">Premium</option>
                                    <option value="Luxury">Luxury</option>
                                </select>
                            </div>
                            <div class="col">
                                <label for="carWaiverAmount">Waiver Amount</label>
                                <input class="form-control" id="carWaiverAmount" placeholder="Waiver Amount"
                                       type="text">
                            </div>
                            <div class="col">
                                <label for="carStates">States</label>
                                <input class="form-control" disabled id="carStates" placeholder="States"
                                       type="text" value="active">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                        <button class="btn btn-warning" id="btnUpdate" onclick="CarUpdate()" type="button">Update
                        </button>
                        <button class="btn btn-primary" id="btnCarSave" onclick="saveCar()" type="button">Save</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <hr>
    <div class="container" style="padding: 10px; background-color: #f5f5f5; display: block;">
        <table class="table table-hover">
            <thead class="bg-purple text-white">
            <tr>
                <th scope="col">Reg No</th>
                <th scope="col">Brand</th>
                <th class="d-none" scope="col">Colour</th>
                <th class="d-none" scope="col">Passenger Count</th>
                <th class="d-none" scope="col">Daily Free KM</th>
                <th class="d-none" scope="col">Daily Rate</th>
                <th class="d-none" scope="col">Monthly Free KM</th>
                <th class="d-none" scope="col">Monthly Rate</th>
                <th scope="col">Driven KM</th>
                <th class="d-none" scope="col">Extra KM Price</th>
                <th class="d-none" scope="col">Fuel Type</th>
                <th class="d-none" scope="col">Transmission Type</th>
                <th scope="col">Type</th>
                <th scope="col">Waiver Amount</th>
                <th scope="col">States</th>
                <th scope="col">Options</th>
            </tr>
            </thead>
            <tbody id="carTableBody">
            </tbody>
        </table>
    </div>
</div>

<div class="container" id="customerSection" style="padding: 10px; background-color: #f5f5f5; display: none;">
    <div class="row">
        <div class="col">
            <input class="form-control" placeholder="Search Customer" type="text">
        </div>
        <div class="col">
            <button class="btn btn-primary" type="button">Search</button>
        </div>
    </div>
    <hr>
    <table class="table table-hover">
        <thead class="bg-purple text-white">
        <tr>
            <th scope="col">NIC No</th>
            <th scope="col">Name</th>
            <th scope="col">Address</th>
            <th scope="col">Contact</th>
            <th scope="col">Driving Licence No</th>
        </tr>
        </thead>
        <tbody id="customerTableBody">
        </tbody>
    </table>
</div>

<div class="container-fluid" id="requestSection" style="padding: 10px; background-color: #f5f5f5; display: none;">
    <!-- Modal -->
    <div aria-hidden="true" aria-labelledby="requestActionLabel" class="modal fade" id="requestAction" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="requestActionLabel">Take an Action.</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col">
                            <input class="form-control" disabled id="RequestId" type="text">
                        </div>
                    </div>
                    <div class="row" style="padding: 10px">
                        <div class="col">
                            <button class="btn btn-success" onclick="requestApproval('Approved')" type="button">
                                Approved
                            </button>
                            <button class="btn btn-danger" onclick="requestApproval('Rejected')" type="button">
                                Rejected
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                                <textarea class="form-control" id="rejectReason" name="rejectReason"
                                          rows="5"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                </div>
            </div>
        </div>
    </div>
    <hr>
    <table class="table table-hover">
        <thead class="bg-purple text-white">
        <tr>
            <th scope="col">Req ID</th>
            <th scope="col">Date</th>
            <th scope="col">Customer NIC</th>
            <th scope="col">Driver ID</th>
            <th scope="col">Vehicle No</th>
            <th scope="col">Pick Up Date</th>
            <th scope="col">Drop Date</th>
            <th scope="col">Waiver Amount</th>
            <th scope="col">State</th>
            <th scope="col">Reason</th>
            <th scope="col">Options</th>
        </tr>
        </thead>
        <tbody id="requestTableBody">
        </tbody>
    </table>
</div>

<!--driver-->

<div class="container" id="driverSection" style="padding: 10px; background-color: #f5f5f5; display: none;">
    <div class="d-flex justify-content-end">
        <button class="btn btn-primary" onclick="function showDriverAddModel() {
            $('#adminDriverAddModel').modal('show');
        }
        showDriverAddModel()" type="button">Add Driver
        </button>
        <!-- Add a car   -->
        <div aria-hidden="true" aria-labelledby="staticBackdropLabel" class="modal fade" data-backdrop="static"
             data-keyboard="false"
             id="adminDriverAddModel" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel2">Add New Driver</h5>
                        <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col">
                                <label for="driverNIC">NIC</label>
                                <input class="form-control" id="driverNIC" placeholder="driver NIC No" type="text">
                            </div>
                            <div class="col">
                                <label for="driverFullName">Full Name</label>
                                <input class="form-control" id="driverFullName" placeholder="Driver Full Name" type="text">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label for="driverAddress">Address</label>
                                <input class="form-control" id="driverAddress" placeholder="Driver Address" type="text">
                            </div>
                            <div class="col">
                                <label for="driverContact">Contact</label>
                                <input class="form-control" id="driverContact" placeholder="Driver Contact"
                                       type="text">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
                        <button class="btn btn-warning" id="btnDriverUpdate" onclick="updateDriver()" type="button">Update
                        </button>
                        <button class="btn btn-primary" id="btnDriverSave" onclick="saveDriver()" type="button">Save</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <hr>
    <div class="container" style="padding: 10px; background-color: #f5f5f5; display: block;">
        <table class="table table-hover">
            <thead class="bg-purple text-white">
            <tr>
                <th scope="col">NIC</th>
                <th scope="col">Name</th>
                <th scope="col">Address</th>
                <th scope="col">Contact</th>
            </tr>
            </thead>
            <tbody id="driverTableBody">
            </tbody>
        </table>
    </div>


</div>

<!--Javascript and jQuery-->
<script src="../../assets/js/jquery-3.5.1.min.js"></script>
<script src="../../assets/js/jquery.cookie.js"></script>
<script src="../../assets/js/daterangepicker.js"></script>
<script src="../../assets/bootstrap/js/bootstrap.min.js"></script>
<script src="../../assets/fontawesome/js/all.min.js"></script>
<script>
    function adminDashboardHome() {
        $('#mainDashboard').css('display', 'block');
        $('#carSection').css('display', 'none');
        $('#customerSection').css('display', 'none');
        $('#requestSection').css('display', 'none');
        $('#driverSection').css('display', 'none');
    }

    function adminCarSectionPane() {
        $('#mainDashboard').css('display', 'none');
        $('#carSection').css('display', 'block');
        $('#customerSection').css('display', 'none');
        $('#driverSection').css('display', 'none');
        loadCarsToTable();
    }

    function adminCustomerSectionPane() {
        $('#customerSection').css('display', 'block');
        $('#mainDashboard').css('display', 'none');
        $('#carSection').css('display', 'none');
        $('#requestSection').css('display', 'none');
        $('#driverSection').css('display', 'none');
        loadCustomersToTable();
    }

    function adminRequestSectionPane() {
        $('#customerSection').css('display', 'none');
        $('#mainDashboard').css('display', 'none');
        $('#carSection').css('display', 'none');
        $('#requestSection').css('display', 'block');
        $('#driverSection').css('display', 'none');
        loadRequestToTable();
    }

    function adminDriverSectionPane() {
        $('#customerSection').css('display', 'none');
        $('#mainDashboard').css('display', 'none');
        $('#carSection').css('display', 'none');
        $('#requestSection').css('display', 'none');
        $('#driverSection').css('display', 'block');
        loadDriversToTable();
    }

    $(document).on('click', '#carTableBody .btn-warning', function () {
        // console.log($($($(this).closest('tr')).children().get(0)).text());
        let regNo = $($($(this).closest('tr')).children().get(0)).text();
        let brand = $($($(this).closest('tr')).children().get(1)).text();
        let color = $($($(this).closest('tr')).children().get(2)).text();
        let passengerCount = $($($(this).closest('tr')).children().get(3)).text();
        let dailyFreeKm = $($($(this).closest('tr')).children().get(4)).text();
        let dailyRate = $($($(this).closest('tr')).children().get(5)).text();
        let monthlyFreeKm = $($($(this).closest('tr')).children().get(6)).text();
        let monthlyRate = $($($(this).closest('tr')).children().get(7)).text();
        let drivenKm = $($($(this).closest('tr')).children().get(8)).text();
        let extraKmPrice = $($($(this).closest('tr')).children().get(9)).text();
        let fuelType = $($($(this).closest('tr')).children().get(10)).text();
        let transmissionType = $($($(this).closest('tr')).children().get(11)).text();
        let type = $($($(this).closest('tr')).children().get(12)).text();
        let waiverAmount = $($($(this).closest('tr')).children().get(13)).text();
        let States = $($($(this).closest('tr')).children().get(14)).text();
        $('#carRegNumber').val(regNo);
        $('#carBrand').val(brand);
        $('#carType').val(type);
        $('#carPassengerCount').val(passengerCount);
        $('#carColor').val(color);
        $('#carTransmissionType').val(transmissionType);
        $('#carFuelType').val(fuelType);
        $('#carWaiverAmount').val(waiverAmount);
        $('#carDailyRate').val(dailyRate);
        $('#carMonthlyRate').val(monthlyRate);
        $('#carExtraKmPrice').val(extraKmPrice);
        $('#carDailyFreeKm').val(dailyFreeKm);
        $('#carMonthlyFreeKm').val(monthlyFreeKm);
        $('#carDrivenKm').val(drivenKm);
        $('#carStates').val(States);
        $('#adminCarAddModel').modal('show');
    });

    function requestApproval(v) {
        if (v === "Approved") {
            $("#rejectReason").val("Approved");
        }
        let reqId = $('#RequestId').val();
        let reason = $("#rejectReason").val();
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/rent/?reqId=" + reqId + "&state=" + v + "&reason=" + reason,
            type: "PUT",
            success: function (resp) {
                if (resp.state === true) {
                    $("#mainDashboard").cleanData();
                    alert(resp.message);
                    loadRequestToTable();
                }
            }
        });
    }

    function saveCar() {

        let carObj = {
            regNo: $('#carRegNumber').val(),
            brand: $('#carBrand').val(),
            type: $('#carType').val(),
            passengerCount: Number($('#carPassengerCount').val()),
            color: $('#carColor').val(),
            transmissionType: $('#carTransmissionType').val(),
            fuelType: $('#carFuelType').val(),
            waiverAmount: Number($('#carWaiverAmount').val()),
            dailyRate: Number($('#carDailyRate').val()),
            monthlyRate: Number($('#carMonthlyRate').val()),
            extraKmPrice: Number($('#carExtraKmPrice').val()),
            dailyFreeKm: Number($('#carDailyFreeKm').val()),
            monthlyFreeKm: Number($('#carMonthlyFreeKm').val()),
            drivenKm: Number($('#carDrivenKm').val()),
            states: $('#carStates').val()
        };
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/car",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(carObj),
            success: function (resp) {
                if (resp.state === true) {
                    alert(resp.message);
                    $('#adminCarAddModel').modal('hide');
                    loadCarsToTable();
                } else {
                    alert(resp.message);
                }
            }
        });
    }

    function CarUpdate() {
        let carObj = {
            regNo: $('#carRegNumber').val(),
            brand: $('#carBrand').val(),
            type: $('#carType').val(),
            passengerCount: Number($('#carPassengerCount').val()),
            color: $('#carColor').val(),
            transmissionType: $('#carTransmissionType').val(),
            fuelType: $('#carFuelType').val(),
            waiverAmount: Number($('#carWaiverAmount').val()),
            dailyRate: Number($('#carDailyRate').val()),
            monthlyRate: Number($('#carMonthlyRate').val()),
            extraKmPrice: Number($('#carExtraKmPrice').val()),
            dailyFreeKm: Number($('#carDailyFreeKm').val()),
            monthlyFreeKm: Number($('#carMonthlyFreeKm').val()),
            drivenKm: Number($('#carDrivenKm').val()),
            states: $('#carStates').val()
        };
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/car",
            type: "PUT",
            contentType: "application/json",
            data: JSON.stringify(carObj),
            success: function (resp) {
                if (resp.state === true) {
                    alert(resp.message);
                    $('#adminCarAddModel').modal('hide');
                    loadCarsToTable();
                } else {
                    alert(resp.message);
                }
            }
        });
    }

    $(document).on('click', '#carTableBody .btn-danger', function () {
        let regNo = $($($(this).closest('tr')).children().get(0)).text();
        if (confirm("Atr you sure?? do you want to delete " + regNo)) {
            $.ajax({
                url: "https://carsys.azurewebsites.net/api/v1/car?id=" + regNo,
                type: "DELETE",
                success: function (resp) {
                    if (resp.state === true) {
                        alert(resp.message);
                        loadCarsToTable();
                    } else {
                        alert(resp.message);
                    }
                }
            });
        }
    });


    function loadCarsToTable() {
        $('#carTableBody').empty();
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/car/all",
            type: "GET",
            success: function (resp) {
                if (resp.state === true) {
                    let data = resp.data;
                    for (let i in data) {
                        $('#carTableBody').append(`
                        <tr>
                            <td scope="row">${data[i].regNo}</td>
                            <td>${data[i].brand}</td>
                            <td class="d-none">${data[i].color}</td>
                            <td class="d-none">${data[i].passengerCount}</td>
                            <td class="d-none">${data[i].dailyFreeKm}</td>
                            <td class="d-none">${data[i].dailyRate}</td>
                            <td class="d-none">${data[i].monthlyFreeKm}</td>
                            <td class="d-none">${data[i].monthlyRate}</td>
                            <td>${data[i].drivenKm}</td>
                            <td class="d-none">${data[i].extraKmPrice}</td>
                            <td class="d-none">${data[i].fuelType}</td>
                            <td class="d-none">${data[i].transmissionType}</td>
                            <td>${data[i].type}</td>
                            <td>${data[i].waiverAmount}</td>
                            <td class="mt-2 badge badge-pill ${data[i].states == "active" ? "badge-success" : "badge-danger"}">${data[i].states}</td>
                            <td><button class="btn btn-warning mr-1" type="button">Update</button>
                            <button class="btn btn-danger" type="button">Delete</button></td>
                        </tr>`);
                    }
                }
            }
        });
    }

    function loadCustomersToTable() {
        $('#customerTableBody').empty();
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/customer",
            type: "GET",
            success: function (resp) {
                if (resp.state === true) {
                    let data = resp.data;
                    for (let i in data) {
                        $('#customerTableBody').append(`
                        <tr>
                            <td scope="row">${data[i].nic}</td>
                            <td>${data[i].name}</td>
                            <td>${data[i].address}</td>
                            <td>${data[i].contact}</td>
                            <td>${data[i].drivingLicNo}</td>
                        </tr>`);
                    }
                }
            }
        });
    }

    function loadDriversToTable() {
        $('#driverTableBody').empty();
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/driver/all",
            type: "GET",
            success: function (resp) {
                if (resp.state === true) {
                    let data = resp.data;
                    for (let i in data) {
                        $('#driverTableBody').append(`
                        <tr>
                            <td scope="row">${data[i].nic}</td>
                            <td>${data[i].name}</td>
                            <td>${data[i].address}</td>
                            <td>${data[i].contact}</td>
                        </tr>`);
                    }
                }
            }
        });
    }

    $(document).on('click', '#requestTableBody .btn-info', function () {
        let id = $($($(this).closest('tr')).children().get(0)).text();
        $('#RequestId').val(id);
        $('#requestAction').modal('show');
    });

    function loadRequestToTable() {
        $('#requestTableBody').empty();
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/rent/all",
            type: "GET",
            success: function (resp) {
                if (resp.state === true) {
                    let data = resp.data;
                    for (let i in data) {
                        $('#requestTableBody').append(
                            `<tr>
                                <td scope="row">${data[i].reqId}</td>
                                <td>${data[i].palaceDate}</td>
                                <td>${data[i].customer.nic}</td>
                                <td><a class="badge badge-light" role="button">${data[i].driver == null ? "No Driver Requested." : data[i].driver.nic}</a></td>
                                <td>${data[i].car.regNo}</td>
                                <td>${data[i].fromDate}</td>
                                <td>${data[i].toDate}</td>
                                <td>${data[i].waiverAmount}</td>
                                <td class="badge badge-pill ${data[i].state == "Pending" ? "badge-primary" : data[i].state == "Approved" ? "badge-success" : data[i].state == "Rejected" ? "badge-danger" : "badge-secondary"}">${data[i].state}</td>
                                <td>${data[i].reason == null ? "No Reason" : data[i].reason}</td>
                                <td><button type="button" class="btn btn-info">Action</button></td>
                            </tr>`
                        );
                    }
                }
            }
        });
    }

    function logOut() {
        if (!!$.cookie('user-id') && !!$.cookie('user-email')) {
            $.removeCookie('user-id', {path: '/'});
            $.removeCookie('user-email', {path: '/'});
            location.href = '../../user/login.html';
        } else {
            location.href = '../../user/login.html';
        }
    }

    function saveDriver() {

        let driverObj = {
            nic: $('#driverNIC').val(),
            fullName: $('#driverFullName').val(),
            address: $('#driverAddress').val(),
            contact: $('#driverContact').val(),
        };
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/driver",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(driverObj),
            success: function (resp) {
                if (resp.state === true) {
                    alert(resp.message);
                    $('#adminDriverAddModel').modal('hide');
                    loadCarsToTable();
                } else {
                    alert(resp.message);
                }
            }
        });
    }

    function updateDriver() {

        let driverObj = {
            nic: $('#driverNIC').val(),
            fullName: $('#driverFullName').val(),
            address: $('#driverAddress').val(),
            contact: $('#driverContact').val(),
        };
        $.ajax({
            url: "https://carsys.azurewebsites.net/api/v1/driver",
            type: "PUT",
            contentType: "application/json",
            data: JSON.stringify(driverObj),
            success: function (resp) {
                if (resp.state === true) {
                    alert(resp.message);
                    $('#adminDriverAddModel').modal('hide');
                    loadCarsToTable();
                } else {
                    alert(resp.message);
                }
            }
        });
    }

</script>
</body>
</html>
